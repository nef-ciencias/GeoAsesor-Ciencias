name: Respuesta del GeoAsesor
on:
  discussion:
    types: [created]
  discussion_comment:
    types: [created]

jobs:
  responder:
    runs-on: ubuntu-latest
    permissions:
      discussions: write
      contents: read
    steps:
      - name: Descargar repositorio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Instalar dependencias
        run: pip install azure-ai-inference

      - name: Ejecutar Asesor
        id: run_script
        env:
          GITHUB_TOKEN: ${{ secrets.GH_MODELS_TOKEN }}
          GITHUB_EVENT_PATH: ${{ github.event_path }}
        run: |
          python scripts/main.py > response.txt
          echo "ANSWER_FILE=response.txt" >> $GITHUB_ENV
      # ... (pasos anteriores: Instalar dependencias, Ejecutar Asesor, etc.)

      - name: Guardar Base de Datos JSON en el repositorio
        run: |
          git config --global user.name "GeoAsesor-Bot"
          git config --global user.email "bot@ciencias.unam.mx"
          git add db_alumnos.json
          git commit -m "Actualizar límite de consultas diarias" || echo "No hay cambios para commitear"
          git push

      - name: Publicar comentario en la Discussion
      # ... (resto de tu código de GraphQL)
      - name: Publicar comentario en la Discussion
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const body = fs.readFileSync('response.txt', 'utf8');
            
            const query = `mutation($discussionId: ID!, $body: String!) {
              addDiscussionComment(input: {discussionId: $discussionId, body: $body}) {
                comment {
                  id
                }
              }
            }`;
            
            const variables = {
              discussionId: context.payload.discussion.node_id,
              body: body
            };
            
            await github.graphql(query, variables);
